<div class="container fade-in">
    <h2>User Profile</h2>

    <div class="profile-card" *ngIf="user">
        <div class="profile-header">
            <div class="avatar-container">
                <img [src]="user.profilePictureUrl || 'assets/default-avatar.png'" alt="Profile Picture" class="avatar">
            </div>
            <div class="profile-info" *ngIf="!isEditing">
                <h3>{{ user.username }}</h3>
                <p class="email">{{ user.email }}</p>
                <p class="bio" *ngIf="user.bio">{{ user.bio }}</p>
                <p class="bio placeholder" *ngIf="!user.bio">No bio provided yet.</p>
                <button (click)="toggleEdit()" class="btn btn-secondary">Edit Profile</button>
            </div>

            <div class="profile-edit" *ngIf="isEditing">
                <div class="form-group">
                    <label>Bio</label>
                    <textarea [(ngModel)]="editUser.bio" rows="4"></textarea>
                </div>
                <div class="actions">
                    <button (click)="saveProfile()" class="btn btn-primary">Save</button>
                    <button (click)="toggleEdit()" class="btn btn-outline">Cancel</button>
                </div>
            </div>
        </div>

        <hr>

        <div class="upload-section">
            <h3>Change Profile Picture</h3>
            <div class="upload-controls">
                <input type="file" (change)="onFileSelected($event)" accept="image/*">
                <button (click)="uploadPicture()" [disabled]="!selectedFile" class="btn btn-primary">Upload</button>
            </div>
        </div>

        <div *ngIf="message" class="alert success">{{ message }}</div>
    </div>

    <div class="orders-section" *ngIf="orders.length > 0">
        <h3>Order History</h3>
        <div class="order-card" *ngFor="let order of orders">
            <div class="order-header">
                <span>Order #{{ order.id }}</span>
                <span>{{ order.orderDate | date:'medium' }}</span>
                <span class="status">{{ order.status }}</span>
            </div>
            <div class="order-items">
                <div *ngFor="let item of order.items" class="order-item">
                    <img [src]="item.game.imageUrl" alt="Cover" class="thumb">
                    <span>{{ item.game.title }}</span>
                    <span>${{ item.price }}</span>
                </div>
            </div>
            <div class="order-total">
                <strong>Total: ${{ order.totalAmount }}</strong>
            </div>
        </div>
    </div>
    <div *ngIf="orders.length === 0" class="no-orders">
        <h3>No orders yet.</h3>
    </div>
</div>